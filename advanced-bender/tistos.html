
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>TisTos-family of methods Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="The Starterkit team and contributors">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-panels/panels.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-katex-auto-render/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="tools.html" />
    
    
    <link rel="prev" href="fill.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    The Bender tutorials
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../getting-started/">
            
                <a href="../getting-started/">
            
                    
                    Getting started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../getting-started/twouseless.html">
            
                <a href="../getting-started/twouseless.html">
            
                    
                    The first two (almost useless) examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../getting-started/firstalgorithms.html">
            
                <a href="../getting-started/firstalgorithms.html">
            
                    
                    The first algorithms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="../getting-started/createcompounds.html">
            
                <a href="../getting-started/createcompounds.html">
            
                    
                    Loops & compounds
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="./">
            
                <a href="./">
            
                    
                    Advanced Bender
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="fill.html">
            
                <a href="fill.html">
            
                    
                    Fill-family of methods
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.1.2" data-path="tistos.html">
            
                <a href="tistos.html">
            
                    
                    TisTos-family of methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="tools.html">
            
                <a href="tools.html">
            
                    
                    Using tools
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../simulation/">
            
                <a href="../simulation/">
            
                    
                    Bender & simulation 
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../simulation/mctruth.html">
            
                <a href="../simulation/mctruth.html">
            
                    
                    MC truth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../simulation/mcmatch.html">
            
                <a href="../simulation/mcmatch.html">
            
                    
                    MC match
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="../simulation/hepmc.html">
            
                <a href="../simulation/hepmc.html">
            
                    
                    Processing of HepMC
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../bender-script/">
            
                <a href="../bender-script/">
            
                    
                     BenderScript 
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../standard-scripts/">
            
                <a href="../standard-scripts/">
            
                    
                     Standard Bender scripts 
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../standard-scripts/">
            
                <a href="../standard-scripts/">
            
                    
                    dst-dump
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="../standard-scripts/">
            
                <a href="../standard-scripts/">
            
                    
                    get-dbtags
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.3" data-path="../standard-scripts/">
            
                <a href="../standard-scripts/">
            
                    
                    get-metainfo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.4" data-path="../standard-scripts/">
            
                <a href="../standard-scripts/">
            
                    
                    trg-check
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.5" data-path="../standard-scripts/">
            
                <a href="../standard-scripts/">
            
                    
                    no-mc-decays
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../ganga/">
            
                <a href="../ganga/">
            
                    
                     Bender & Ganga/GRID
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../CONTRIBUTING.html">
            
                <a href="../CONTRIBUTING.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="9.1" >
            
                <a target="_blank" href="ref://bender-tutorials.pdf">
            
                    
                    Download PDF
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >TisTos-family of methods</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="handling-of-tistos-information-in-bender">Handling of <code>TisTos</code>-information in Bender</h1>
<p>Bender offers set of methods to handle <code>TisTos</code>-information in (relatively) easy way.
This functionality  comes from <code>BenderTools.TisTos</code> module.
In short, it adds three relates method in the base class <code>Algo</code>:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Short description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>decisions</code></td>
<td>collect the trigger decisions for the given particle</td>
</tr>
<tr>
<td><code>trgDecs</code></td>
<td>print the collected trigger statistics in readable way</td>
</tr>
<tr>
<td><code>tisTos</code></td>
<td>fill N-tuple with <code>TisTos</code>-information</td>
</tr>
</tbody>
</table>
<p>All of them are (relatively well) documented and one can easily inspect them:</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> BenderTools.TisTos
<span class="hljs-keyword">from</span> Bender.Main <span class="hljs-keyword">import</span> Algo
help(Algo.decisions)
</code></pre>
<h2 id="how-to-know-what-trigger-lines-are-relevant-or-the-given-decayparticle">How to know what trigger lines are relevant or the given decay/particle?</h2>
<p>Often information about the releavant trigger lines are spread in corridors 
in a form of myths, general beliefs or, in the best case, references to ANA-notes 
for some similar analysis. However it is very simple to collect 
this infomation using Bender. The method <code>decisions</code> is our friend here. 
the usage of  this method require some preparatory work for the algorithm, 
namely one needs to instrument <code>initialize</code>-method:</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TrgLines</span><span class="hljs-params">(Algo)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;Collect infomation about the trigger lines relevant for certain decays/particles
    &quot;&quot;&quot;</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span> <span class="hljs-params">( self )</span> :</span>

        sc = Algo.initialize ( self ) <span class="hljs-comment">## initialize the base class</span>
        <span class="hljs-keyword">if</span> sc.isFailure() : <span class="hljs-keyword">return</span> sc

        <span class="hljs-comment">#</span>
        <span class="hljs-comment">## container to collect trigger information, e.g. list of fired lines </span>
        <span class="hljs-comment">#</span>
        triggers = {}
        triggers [<span class="hljs-string">&apos;psi&apos;</span>] = {} <span class="hljs-comment">## slot to keep the information for J/psi </span>
        triggers [<span class="hljs-string">&apos;K&apos;</span>]   = {} <span class="hljs-comment">## slot to keep the information for kaons  </span>
        triggers [<span class="hljs-string">&apos;B&apos;</span>]   = {} <span class="hljs-comment">## slot to keep the information for B-mesons </span>

        sc = self.tisTos_initialize ( triggers , lines = {} )
        <span class="hljs-keyword">if</span> sc.isFailure() : <span class="hljs-keyword">return</span> sc

        <span class="hljs-keyword">return</span> SUCCESS
</code></pre>
<p>Here in this example we want to collect <code>TisTos</code>-information 
for <code>J/psi</code>, <code>K</code> and the whole <code>B+</code>-meson. Then in the main <code>analyse</code>-method one just needs to invoke 
the method <code>decisions</code> for each particles  in interest:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">analyse</span><span class="hljs-params">( self )</span> :</span>   <span class="hljs-comment">## IMPORTANT! </span>
  <span class="hljs-string">&quot;&quot;&quot;The main &apos;analysis&apos; method &quot;&quot;&quot;</span>
  ...         
  <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> particles :

      psi =b(<span class="hljs-number">1</span>) <span class="hljs-comment">## the first  daughter: J/psi </span>
      k   =b(<span class="hljs-number">2</span>) <span class="hljs-comment">## the second daughter: K </span>

      <span class="hljs-comment">## collect trigger information for J/psi </span>
      self.decisions   ( psi , self.triggers[<span class="hljs-string">&apos;psi&apos;</span>] )

      <span class="hljs-comment">## collect trigger information for kaons </span>
      self.decisions   ( k   , self.triggers[<span class="hljs-string">&apos;K&apos;</span>]   )

      <span class="hljs-comment">## collect trigger information for B-mesons </span>
      self.decisions   ( b   , self.triggers[<span class="hljs-string">&apos;B&apos;</span>]   ) 

  ...     
  <span class="hljs-keyword">return</span> SUCCESS
</code></pre>
<p>Thats all. Then when jobs runs  it dumps to the log-file the running trigger statistics, 
and the statistics is dumped into the file <code>TrgLines_tistos.txt</code> (<code>&lt;ALGNAME&gt;_tistos.txt</code> in general).
The summary table looks like:</p>
<pre><code>******************************************************************************************
 Triggers for  psi
******************************************************************************************
Hlt1_TIS psi   #lines:     7 #events 321   
 (  0.62 +- 0.44 )       Hlt1DiMuonHighMassDecision 
 (  0.62 +- 0.44 )       Hlt1DiMuonLowMassDecision 
 ( 19.00 +- 2.19 )       Hlt1TrackAllL0Decision 
 (  3.74 +- 1.06 )       Hlt1TrackAllL0TightDecision 
 (  4.36 +- 1.14 )       Hlt1TrackMuonDecision 
 (  0.93 +- 0.54 )       Hlt1TrackPhotonDecision 
 (  0.31 +- 0.31 )       Hlt1VertexDisplVertexDecision 
 (100.00 +- 0.31 )       TOTAL 
Hlt1_TOS psi   #lines:     9 #events 321   
 ( 72.90 +- 2.48 )       Hlt1DiMuonHighMassDecision 
 ( 59.81 +- 2.74 )       Hlt1DiMuonLowMassDecision 
 (  0.31 +- 0.31 )       Hlt1DiProtonDecision 
 (  9.03 +- 1.60 )       Hlt1SingleMuonHighPTDecision 
 (  0.31 +- 0.31 )       Hlt1SingleMuonNoIPDecision 
 ( 44.24 +- 2.77 )       Hlt1TrackAllL0Decision 
 ( 10.90 +- 1.74 )       Hlt1TrackAllL0TightDecision 
 ( 74.77 +- 2.42 )       Hlt1TrackMuonDecision 
 (  0.31 +- 0.31 )       Hlt1TrackPhotonDecision 
 (100.00 +- 0.31 )       TOTAL 
Hlt1_TPS psi   #lines:     6 #events 321   
 ( 13.71 +- 1.92 )       Hlt1DiMuonHighMassDecision 
 ( 10.90 +- 1.74 )       Hlt1DiMuonLowMassDecision 
 (  0.31 +- 0.31 )       Hlt1DiProtonDecision 
 (  3.12 +- 0.97 )       Hlt1TrackAllL0Decision 
 (  0.93 +- 0.54 )       Hlt1TrackAllL0TightDecision 
 (  4.67 +- 1.18 )       Hlt1TrackMuonDecision 
 (100.00 +- 0.31 )       TOTAL
</code></pre><p>Only a short fragment is shown here, one gets similar fragments for all declared 
particles (<code>psi</code>, <code>K</code> and <code>B</code>) and for all trigger levels (<code>L0</code>, <code>Hlt1</code> and <code>Hlt2</code>).
The full table is accessible <a href="https://gist.github.com/VanyaBelyaev/90cc0f9b1ab84c8e40e2cd2ccf321bc3" target="_blank">here</a>
The content of the summaty table is rather intuitive: it summarizes the fire frequences for 
varios trugegr lines for three regimes <code>TIS</code>, <code>TOS</code> and <code>TPS</code>. 
Inspecting such table, one immediately concludes that the most relevan <code>Hlt1-TOS</code>-line
is <code>Hlt1DiMuonHighMassDecision</code>. Other <code>Hlt1-TOS</code>-lines are  less relevant here. 
But please note that here only very small statistics is used (321 event), 
and with larger statistics sthe conclusions could be corrected.
E.g. due to  small statistics here, for <code>Hlt1-TIS</code>-lines the choice is not evident:
one clearly see that <code>Hlt1TrackAllL0Decision</code> line is important, but for 
importance of other lines one csn judge only after the 
significant increase of the statistics.</p>
<p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(2688900409);" id="what-is-tistosdb-fileclick-to-expand"><i class="fa fa-bell"></i> What is `<algname>_tistos.db` file?<span id="heading-2688900409">Click to expand</span></algname></h3></div><div class="panel-body" style="display: none" id="panel-2688900409"><p>In practice to make a decision, large statistics is required (for real data and/or for simulated samples).
And here these files are very useful. 
The trigger statistics is  saved not only in <code>&lt;ALGNAME&gt;_tistos.txt</code>-file but also in <code>shelve</code>-dbase 
<code>&lt;ALGNAME&gt;_tistos.db</code>.<br>If really large statistics is required there are some utilities to merge the 
information from these <code>&lt;ALGNAME&gt;_tistos.db</code> together, e.g. on the output of Ganga jobs.</p>
</div></div></p>
<p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(3814263939);" id="challenge"><i class="fa fa-square-o"></i> Challenge<span id="heading-3814263939"></span></h3></div><div class="panel-body" id="panel-3814263939"><ol>
<li>Add <code>decisions</code>-function for your previous Bender module with n-tuples. <ul>
<li>(Do not  forget to instrument the <code>initialize</code> method)</li>
</ul>
</li>
<li>Run it and observe the output summary table </li>
<li>Identify the relevant  <code>L0-TOS</code>, <code>Hlt1-TOS</code> and <code>Hlt2-TOS</code> lines for your decay <ul>
<li>Does it correspond to your  expectations?</li>
</ul>
</li>
</ol>
<div class="panel panel-danger"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(5018370158);" id="solution"><i class="fa fa-line-chart"></i> Solution<span id="heading-5018370158"></span></h3></div><div class="panel-body" id="panel-5018370158"><p>The complete module is accessible <a href="https://gist.github.com/VanyaBelyaev/0e12d07b705dcd4af48aea8dad02f727" target="_blank">here</a>
and the corresponsing summary table is <a href="https://gist.github.com/VanyaBelyaev/90cc0f9b1ab84c8e40e2cd2ccf321bc3" target="_blank">here</a></p>
</div></div></div></div></p>
<h2 id="how-to-add-the-tistos-information-to-n-tupletree">How to add the <code>TisTos</code>-information to n-tuple/tree?</h2>
<p>Now, when we have the lists of the relevant lines, one  wants to add infrommation   about the decisions of these lines into  n-tuple/tree.
The method <code>tistos</code> is out friend here. To use this method one needs to instrument <code>initialize</code>-method:</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TisTosTuple</span><span class="hljs-params">(Algo)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;Enhanced functionality for n-tuples 
    &quot;&quot;&quot;</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span> <span class="hljs-params">( self )</span> :</span>

        sc = Algo.initialize ( self ) <span class="hljs-comment">## initialize the base class</span>
        <span class="hljs-keyword">if</span> sc.isFailure() : <span class="hljs-keyword">return</span> sc

        <span class="hljs-comment">#</span>
        <span class="hljs-comment">## container to collect trigger information, e.g. list of fired lines </span>
        <span class="hljs-comment">#</span>
        triggers = {}
        triggers [<span class="hljs-string">&apos;psi&apos;</span>] = {} <span class="hljs-comment">## slot to keep information for J/psi </span>

        <span class="hljs-comment">#</span>
        <span class="hljs-comment">## the lines to be investigated in details</span>
        <span class="hljs-comment">#</span>
        lines    = {}
        lines    [ <span class="hljs-string">&quot;psi&quot;</span> ] = {} <span class="hljs-comment">## trigger lines for J/psi</span>

        <span class="hljs-comment">## six mandatory keys:</span>
        lines    [ <span class="hljs-string">&quot;psi&quot;</span> ][   <span class="hljs-string">&apos;L0TOS&apos;</span> ] = <span class="hljs-string">&apos;L0(DiMuon|Muon)Decision&apos;</span>
        lines    [ <span class="hljs-string">&quot;psi&quot;</span> ][   <span class="hljs-string">&apos;L0TIS&apos;</span> ] = <span class="hljs-string">&apos;L0(Hadron|DiMuon|Muon|Electron|Photon)Decision&apos;</span>
        lines    [ <span class="hljs-string">&quot;psi&quot;</span> ][ <span class="hljs-string">&apos;Hlt1TOS&apos;</span> ] = <span class="hljs-string">&apos;Hlt1(DiMuon|TrackMuon).*Decision&apos;</span>
        lines    [ <span class="hljs-string">&quot;psi&quot;</span> ][ <span class="hljs-string">&apos;Hlt1TIS&apos;</span> ] = <span class="hljs-string">&apos;Hlt1(DiMuon|SingleMuon|Track).*Decision&apos;</span>
        lines    [ <span class="hljs-string">&quot;psi&quot;</span> ][ <span class="hljs-string">&apos;Hlt2TOS&apos;</span> ] = <span class="hljs-string">&apos;Hlt2DiMuon.*Decision&apos;</span>
        lines    [ <span class="hljs-string">&quot;psi&quot;</span> ][ <span class="hljs-string">&apos;Hlt2TIS&apos;</span> ] = <span class="hljs-string">&apos;Hlt2(Charm|Topo|DiMuon|Single).*Decision&apos;</span>

        sc = self.tisTos_initialize ( triggers , lines )
        <span class="hljs-keyword">if</span> sc.isFailure() : <span class="hljs-keyword">return</span> sc

        <span class="hljs-keyword">return</span> SUCCESS
</code></pre>
<p>Here one defines six <code>regex</code>-patterns that describe the six sets of triggers lines:
<code>L0</code>, <code>Hlt1</code>, <code>Hlt2</code> vs <code>TIS</code>, <code>TOS</code>. These expressions are coded according to the infomration, 
obtainer earlier. The next step is rather trivial: in <code>analyse</code> method one need to invoke 
the method <code>tistos</code> for the given particle, J/psi in our case:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">analyse</span><span class="hljs-params">( self )</span> :</span>  
    <span class="hljs-string">&quot;&quot;&quot;The main &apos;analysis&apos; method&quot;&quot;&quot;</span>
    ...
    tup = self.nTuple(<span class="hljs-string">&apos;MyTuple&apos;</span>)
    <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> particles :            
        psi =b(<span class="hljs-number">1</span>) <span class="hljs-comment">## the first daughter: J/psi             </span>
        ...             
        <span class="hljs-comment">## fill n-tuple with TISTOS information for J/psi</span>
        self.tisTos      (
            psi               , <span class="hljs-comment">## particle </span>
            tup               , <span class="hljs-comment">## n-tuple</span>
            <span class="hljs-string">&apos;psi_&apos;</span>            , <span class="hljs-comment">## prefix for variable name in n-tuple</span>
            self.lines[<span class="hljs-string">&apos;psi&apos;</span>] , <span class="hljs-comment">## trigger lines to be inspected</span>
            verbose = <span class="hljs-keyword">True</span>      <span class="hljs-comment">## good ooption for those who hates bit-wise operations </span>
            )            
        tup.write()             
   ... 
   <span class="hljs-keyword">return</span> SUCCESS
</code></pre>
<p>This code adds several variables into  n-tuple/tree, see log-file or use <code>help(Algo.tistos)</code>.
Also <code>TisTos</code>-information for  <em>global</em> and <em>physics</em> triggers is added.
<div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(9403620279);" id="in-detailsclick-to-expand"><i class="fa fa-bell"></i> In details,<span id="heading-9403620279">Click to expand</span></h3></div><div class="panel-body" style="display: none" id="panel-9403620279"><p>The fragment from log-file:</p>
<pre><code># BenderTools.TisTos        INFO    tisTos: Fill TisTos information into n-tuple
#    
#    # for d in particles : 
#    #    self.tisTos ( d     ,
#    #                  tup   ,
#    #                 &apos;d0_&apos;  ,
#    #                 self.lines [&apos;D0&apos;] , 
#    #                 self.l0tistos     ,
#    #                 self.l1tistos     ,
#    #                 self.l2tistos     )
#    
#    ``lines&apos;&apos; here is a dictionary of lines (or regex-patterns) with
#    following keys:
#    - L0TOS
#    - L0TIS
#    - Hlt1TOS
#    - Hlt1TIS
#    - Hlt2TOS
#    - Hlt2TIS
#
#    e.g.
#    
#    # lines = {}
#    # lines [&apos;L0TOS&apos;  ] = &apos;L0HadronDecision&apos;
#    # lines [&apos;L0TIS&apos;  ] = &apos;L0(Hadron|Muon|DiMuon)Decision&apos;
#    # lines [&apos;Hlt1TOS&apos;] = ...
#    # lines [&apos;Hlt1TIS&apos;] = &apos;Hlt1Topo.*Decision&apos;
#    # lines [&apos;Hlt2TOS&apos;] = ...
#    # lines [&apos;Hlt2TIS&apos;] = ...
#    
#    Technically it is useful to keep it as ``per-particle-type&apos;&apos; dictionary
#    
#    # def initialize ( self ) :
#    #     ...
#    #     self.lines           = {}
#    #     self.lines [&apos;B&apos;  ]   = {}
#    #     self.lines [&apos;B&apos;  ][&apos;L0TOS&apos;] = ...
#    #     self.lines [&apos;B&apos;  ][&apos;L0TOS&apos;] = ...
#    #     ...
#    #     self.lines [&apos;psi&apos;]   = {}
#    #     self.lines [&apos;psi&apos;][&apos;L0TOS&apos;] = ...
#    #     ...
#    #     return SUCCESS
#    
#    # def analyse ( self ) : 
#        
#    #     particles = ...
#        
#    #     for B in particles : 
#    #         self.tisTos ( B     ,
#    #                       tup   ,
#    #                       &apos;B0_&apos; ,
#    #                       self.lines[&apos;B&apos;]   , 
#    #                       self.l0tistos     ,
#    #                       self.l1tistos     ,
#    #                       self.l2tistos     )
#
#    #     ...
#    #     return SUCCESS
#    
#    The function adds few columns to n-tuple, the most important are
#    - ``&lt;label&gt;l0tos&apos;&apos; that corresponds to   &apos;L0-TOS&apos;  
#    - ``&lt;label&gt;l0tis&apos;&apos; that corresponds to   &apos;L0-TIS&apos;  
#    - ``&lt;label&gt;l1tos&apos;&apos; that corresponds to &apos;Hlt1-TOS&apos;  
#    - ``&lt;label&gt;l1tis&apos;&apos; that corresponds to &apos;Hlt1-TIS&apos;  
#    - ``&lt;label&gt;l2tos&apos;&apos; that corresponds to &apos;Hlt2-TOS&apos;  
#    - ``&lt;label&gt;l2tis&apos;&apos; that corresponds to &apos;Hlt2-TIS&apos;
#    Additionally information for five predefined lists is stored:
#    - ``&lt;label&gt;l0phys&apos;&apos; : L0-physics lines,
#    - ``&lt;label&gt;l1phys&apos;&apos; : Hlt1-physics lines  (routing bit #46)
#    - ``&lt;label&gt;l2phys&apos;&apos; : Hlt2-physics lines  (routing bit #77)
#    - ``&lt;label&gt;l1glob&apos;&apos; : Hlt1Global decision 
#    - ``&lt;label&gt;l2glob&apos;&apos; : Hlt2Global decision 
#    
#    The stored value is unsigned short, a bit-representaion of ITisTos::TisTosTob object
#    - see ITisTos
#    - see ITisTos::TisTosTob
#    
#    Later, in processing of TTree one can use these flags as :
#    
#    &gt;&gt;&gt; tree = ...
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;                )  ## no trigger requirements
#    
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l0tos&amp;2)==2&apos;)  ## require L0-tos   with respect to the list of &apos;L0TOS&apos;-lines 
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l1tos&amp;2)==2&apos;)  ## require Hlt1-tos with respect to the list of &apos;Hlt1TOS&apos;-lines 
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l2tos&amp;2)==2&apos;)  ## require Hlt2-tos with respect to the list of &apos;Hlt2TOS&apos;-lines 
#
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l0tis&amp;4)==4&apos;)  ## require L0-tis   with respect to the list of &apos;L0TIS&apos;-lines 
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l1tis&amp;4)==4&apos;)  ## require Hlt1-tis with respect to the list of &apos;Hlt1TIS&apos;-lines 
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l2tis&amp;4)==4&apos;)  ## require Hlt2-tis with respect to the list of &apos;Hlt2TIS&apos;-lines
#    
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l0tos&amp;3)==3&apos;)  ## require L0-tus   with respect to the list of &apos;L0TOS&apos;-lines 
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l1tos&amp;3)==3&apos;)  ## require Hlt1-tus with respect to the list of &apos;Hlt1TOS&apos;-lines 
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l2tos&amp;3)==3&apos;)  ## require Hlt2-tus with respect to the list of &apos;Hlt2TOS&apos;-lines
#    
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l0tos&amp;1)==1&apos;)  ## require L0-tps   with respect to the list of &apos;L0TOS&apos;-lines 
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l1tos&amp;1)==1&apos;)  ## require Hlt1-tps with respect to the list of &apos;Hlt1TOS&apos;-lines 
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l2tos&amp;1)==1&apos;)  ## require Hlt2-tps with respect to the list of &apos;Hlt2TOS&apos;-lines 
#    
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l0phys&amp;2)==2&apos;) ## require L0-tos   with respect to L0-physics lines 
#    &gt;&gt;&gt; tree.Draw(&apos;M&apos;, &apos;(l0phys&amp;4)==4&apos;) ## require L0-tis   with respect to L0-physics lines 
#    
#    One can avoid bit-wise operations using ``verbose=True&apos;&apos; flag.
#    In this case one gets following boolean variables in n-tuple:
#    - ``&lt;labeltag&gt;_tos&apos;&apos;  Trigger On Signal 
#    - ``&lt;labeltag&gt;_tis&apos;&apos;  Trigger Independently on Signal 
#    - ``&lt;labeltag&gt;_tps&apos;&apos;  Trigger Partially on Signal
#    - ``&lt;labeltag&gt;_tus&apos;&apos;  Trigger Used Signal (== TOS || TPS )
#    - ``&lt;labeltag&gt;_dec&apos;&apos;  Trigger decision
#    
#    where ``&lt;labeltag&gt;&apos;&apos; is
#    - ``&lt;label&gt;l0tos&apos;&apos;
#    - ``&lt;label&gt;l0tis&apos;&apos;
#    - ``&lt;label&gt;l0phys&apos;
#    - ``&lt;label&gt;l1tos&apos;&apos;
#    - ``&lt;label&gt;l1tis&apos;&apos;
#    - ``&lt;label&gt;l1phys&apos;
#    - ``&lt;label&gt;l1glob&apos;
#    - ``&lt;label&gt;l2tos&apos;&apos;
#    - ``&lt;label&gt;l2tis&apos;&apos;
#    - ``&lt;label&gt;l2phys&apos;
#    - ``&lt;label&gt;l2glob&apos;
</code></pre></div></div></p>
<p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(3435944145);" id="challenge"><i class="fa fa-square-o"></i> Challenge<span id="heading-3435944145"></span></h3></div><div class="panel-body" id="panel-3435944145"><ol>
<li>Add <code>tistos</code>-function for your previous Bender module with n-tuples. <ul>
<li>(Do not  forget to instrument the <code>initialize</code> method)</li>
</ul>
</li>
<li>Run it and observe new variables in n-tuple/tree</li>
<li>Make a plot of B-mass  for all candidates, and for candiated that are <code>L0-TOS</code>, <code>Hlt-TOS</code> and <code>Hlt2-TOS</code> with respect to the set of selected trigger lines. </li>
</ol>
<div class="panel panel-danger"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(555766125);" id="solution"><i class="fa fa-line-chart"></i> Solution<span id="heading-555766125"></span></h3></div><div class="panel-body" id="panel-555766125"><p>The complete module is accessible <a href="https://gist.github.com/VanyaBelyaev/7ec39d549454388d46292a0bc9e7dbe3" target="_blank">here</a>
and the corresponsing log-file is <a href="https://gist.github.com/VanyaBelyaev/14522f14672f84c171eac9b29df31f68" target="_blank">here</a>
To make the corresponsing plot, e.g. start <code>(i)python</code>:</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> ROOT
f = ROOT.TFile(<span class="hljs-string">&apos;TisTosTuples.root&apos;</span>,<span class="hljs-string">&apos;READ&apos;</span>)
t = f.Get(<span class="hljs-string">&apos;TisTos/MyTuple&apos;</span>)
t.Draw ( <span class="hljs-string">&apos;m_b&apos;</span>  ,<span class="hljs-string">&apos;&apos;</span> , <span class="hljs-string">&apos;e1&apos;</span> )
t.Draw ( <span class="hljs-string">&apos;m_b&apos;</span> , <span class="hljs-string">&apos; psi_l0tos_tos &amp;&amp; psi_l1tos_tos &amp;&amp; psi_l2tos_tos&apos;</span> , <span class="hljs-string">&apos;same hist&apos;</span> )
</code></pre>
<p>The result is here:<img src="https://lhcb.github.io/bender-tutorials/advanced-bender/img/TisTos.png" alt="alt image text"></p>
</div></div></div></div></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="fill.html" class="navigation navigation-prev " aria-label="Previous page: Fill-family of methods">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="tools.html" class="navigation navigation-next " aria-label="Next page: Using tools">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"TisTos-family of methods","level":"3.1.2","depth":2,"next":{"title":"Using tools","level":"3.1.3","depth":2,"path":"advanced-bender/tools.md","ref":"advanced-bender/tools.md","articles":[]},"previous":{"title":"Fill-family of methods","level":"3.1.1","depth":2,"path":"advanced-bender/fill.md","ref":"advanced-bender/fill.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","panels@git+https://github.com/lhcb/gitbook-plugin-panels.git#master","katex-auto-render@git+https://github.com/lhcb/gitbook-plugin-katex-auto-render.git#master","collapsible-menu","otherlink"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"collapsible-menu":{},"search":{},"otherlink":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"panels":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"katex-auto-render":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"The Starterkit team and contributors","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"advanced-bender/tistos.md","mtime":"2018-03-06T12:35:36.706Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-03-06T12:37:44.938Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-panels/panels.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-katex-auto-render/katex.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-katex-auto-render/auto-render.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-katex-auto-render/enable-auto-render.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-otherlink/js/otherlink.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

